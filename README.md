# markov_tensor

## 概要
Python によるマルコフ・テンソルの計算をするスクリプトです。

## 構成
- markov_tensor.py: テンソル計算を実施するメソッドをもつ本体です。

次の 2 個のスクリプトはmarkov_tensor.py からメソッドを呼び出しており、使用例になっています。
- ball_lamp.py: README で説明している例のスクリプトです。
- string_label.py: インデックスとして文字列のラベルをもつ計算例です。
- shadow.py: 影絵クイズと呼ばれるクイズの計算例です。

## markov_tensor.py で実装したメソッド
テンソル計算: 
- 結合演算: メソッド composition
- 恒等射: メソッド identity
- 部分結合: メソッド partial composition
- 同時化: メソッド jointification
- 条件化: メソッド conditionalization
- テンソル積: メソッド tensor_product
- 第一周辺化: メソッド first_marginalization
- 第二周辺化: メソッド second_marginalization
- 反転: メソッド: conversion

テンソルを構成
- 単位テンソル: メソッド unit_tensor
- マルコフ・テンソル Δ: メソッド delta
- マルコフ・テンソル ！: メソッド exclamation
- マルコフ・テンソル Xa,b (スワップ): メソッド swap

## はじめに
### 本スクリプトにおける計算の基本
次のような行と列にインデックスをもつ表を考えます。

ここで、それぞれの列の総和は 1 として、
ある列のインデックスで表現される事象ならば、
ある行のインデックスで表現される事象である確率を、
該当する表のセルに書きます。

例として、次のような表1 と 2 を示します。

表1. 黒、白、赤、緑、または青のボールが混在した容器から、
黒、または白のボールを 1 個選んだ後、
赤、緑、または青のボールを 1 個選ぶ確率の表。 

```console
　　黒　白
-----------
赤  0.1 0.2
緑  0.2 0.3
青  0.7 0.5
```

表2. 上記の容器から、赤、緑、または青のボールを 1 個選んだ際に、
ランダムに光るランプが手元にあるとして、ランプが光る確率。

```console
　　　　　　　　　赤　緑　青
-----------------------------------------
ランプが光る  　　0.8 0.9 0.9
ランプが光らない  0.2 0.1 0.1
```

ここで、表1 と表2 の結合を考えます。

表1 に着目すると、黒いボールを選んだ後に赤いボールを選び (0.1)、
表2 に着目すると、赤いボールを選んだ際にランプが光る (0.8) とします。
そのような確率は 0.1 * 0.8 = 0.08 になります。

同様に、緑のボールについても表1 に着目すると、黒いボールを選んだ後に緑のボールを選び (0.2)、
表2 に着目すると、緑のボールを選んだ際にランプが光る (0.9) とします。
そのような確率は 0.2 * 0.9 = 0.18 になります。

同様に、青いボールについても表1 に着目すると、黒いボールを選んだ後に青いボールを選び (0.7)、
表2 に着目すると、緑のボールを選んだ際にランプが光る (0.9) とします。
そのような確率は 0.7 * 0.9 = 0.63 になります。

上記確率を赤、緑、および青いボールについて総和すると、0.08 + 0.18 + 0.63 = 0.89 = 89/100

表1 と表2 のすべてのセルについて同様な計算をすると、次のような表を得ます。

表3. 上記の容器から、黒または白のボールを 1 個選び、
ランダムに光るランプが手元にあるとして、ランプが光る確率。
```console
　　　　　　　　　黒　　白
-----------------------------------------
ランプが光る  　　89/100 22/25
ランプが光らない  11/100 3/25
```


本スクリプトを用いて計算すると次のようになります。ball_lamp.py を参照ください。

```Python
from fractions import Fraction // 分数を取り扱うために Fraction をインポートします。
import markov_tensor // 結合演算 composition を用いるためにインポートします。

"""
　　黒　白
-----------
赤  0.1 0.2
緑  0.2 0.3
青  0.7 0.5
"""

# 表1 の Python の辞書による表現です。
tensor_ball = {
    "profile": [[['黒', '白']], [['赤', '緑', '青']]], 
    "strands": {
        "[[['黒']], [['赤']]]": Fraction(1, 10), 
        "[[['黒']], [['緑']]]": Fraction(2, 10), 
        "[[['黒']], [['青']]]": Fraction(7, 10), 
        "[[['白']], [['赤']]]": Fraction(2, 10), 
        "[[['白']], [['緑']]]": Fraction(3, 10), 
        "[[['白']], [['青']]]": Fraction(5, 10)
    }
}

"""
　　　　　　　　　赤　緑　青
-----------------------------------------
ランプが光る  　　0.8 0.9 0.9
ランプが光らない  0.2 0.1 0.1
"""

# 表2 の Python の辞書による表現です。
tensor_lamp = {
    "profile": [[['赤', '緑', '青']], [['ランプが光る', 'ランプが光らない']]], 
    "strands": {
        "[[['赤']], [['ランプが光る']]]": Fraction(8, 10),
        "[[['緑']], [['ランプが光る']]]": Fraction(9, 10),
        "[[['青']], [['ランプが光る']]]": Fraction(9, 10),
        "[[['赤']], [['ランプが光らない']]]": Fraction(2, 10),
        "[[['緑']], [['ランプが光らない']]]": Fraction(1, 10),
        "[[['青']], [['ランプが光らない']]]": Fraction(1, 10)
    }
}

def main():
    # メソッド composition で表1 tensor_ball と表2 tensor_lamp の結合演算を実施し、
    # メソッド print_tensor で標準出力します。
    markov_tensor.print_tensor(markov_tensor.composition(tensor_ball, tensor_lamp))

if __name__ == "__main__":
    main()

```

次のような実行結果を得ます。

```console
profile:  [[['黒', '白']], [['ランプが光る', 'ランプが光らない']]]
[[['黒']], [['ランプが光る']]] 89/100
[[['黒']], [['ランプが光らない']]] 11/100
[[['白']], [['ランプが光る']]] 22/25
[[['白']], [['ランプが光らない']]] 3/25
```

### 行と列のラベルがそれぞれ複数ある場合
ここでは、上記の表の行と列のラベルがそれぞれ複数あるような拡張を考えます。

例として、次のような表4 と 5 を示します。

表4. 黒、白、赤、緑、及び青のボールが混在した容器から、
「黒、または白のボールを 1 個」を選び、
金、銀、桃、及び紫のカードが混在したものから
「金、または銀のカードを 1 枚」を選んだ後、

黒、白、赤、緑、及び青のボールが混在した容器から、
「赤、緑、および青のボールを 1 個」を選び、
金、銀、桃、及び紫のカードが混在したものから
「桃、または紫のカードを 1 枚」を選ぶ確率の表。

```console
　　　　(黒, 金)　(黒, 銀）（白, 金）（白, 銀）
--------------------------------------------
(赤, 桃)  0.1　　　　0.1　　　0.1　　　0.1 
(赤, 紫)  0.1　　　　0.1　　　0.1　　　0.1
(緑, 桃)  0.1　　　　0.1　　　0.1　　　0.5
(緑, 紫)  0.1　　　　0.1　　　0.5　　　0.1
(青, 桃)  0.1　　　　0.5　　　0.1　　　0.1
(青, 紫)  0.5　　　　0.1　　　0.1　　　0.1
--------------------------------------------
```

表5. 上記の容器から、
「赤、緑、および青のボールを 1 個」を選び、
金、銀、桃、及び紫のカードが混在したものから
「桃、または紫のカードを 1 枚」を選んだ際に、
ランダムに光るランプが手元に 2 種類あるとして、
ランプ 1 が光る確率と、ランプ 2 が光る確率の表。

```console
　　　　　　　　　　　　　　　　　(赤, 桃) (赤, 紫）(緑, 桃) (緑, 紫）(青, 桃) (青, 紫）
-----------------------------------------------------------------------------------------------
(ランプ 1 が光る, ランプ 2 が光る)  0.1　　　0.1　　　0.1　　　0.2　　　0.2　　　0.3 
(ランプ 1 が光る, ランプ 2 が光る)  0.1　　　0.1　　　0.2　　　0.2　　　0.3　　　0.1
(ランプ 1 が光る, ランプ 2 が光る)  0.1　　　0.2　　　0.2　　　0.3　　　0.1　　　0.1
(ランプ 1 が光る, ランプ 2 が光る)  0.2　　　0.2　　　0.3　　　0.1　　　0.1　　　0.1
(ランプ 1 が光る, ランプ 2 が光る)  0.2　　　0.3　　　0.1　　　0.1　　　0.1　　　0.2
(ランプ 1 が光る, ランプ 2 が光る)  0.3　　　0.1　　　0.1　　　0.1　　　0.2　　　0.2
-----------------------------------------------------------------------------------------------

```
