from fractions import Fraction
import markov_tensor

tensor_h = {
    "profile": [[['M', 'W']], [['H', 'M', 'L']]], 
    "strands": {
        "[[['M']], [['H']]]": Fraction(2, 10), 
        "[[['M']], [['M']]]": Fraction(6, 10), 
        "[[['M']], [['L']]]": Fraction(2, 10), 
        "[[['W']], [['H']]]": Fraction(1, 10), 
        "[[['W']], [['M']]]": Fraction(5, 10), 
        "[[['W']], [['L']]]": Fraction(4, 10)
    }
}

tensor_s = {
    "profile": [[['M', 'W']], [['S+', 'S-']]], 
    "strands": {
        "[[['M']], [['S+']]]": 0, 
        "[[['M']], [['S-']]]": 1, 
        "[[['W']], [['S+']]]": Fraction(5, 10), 
        "[[['W']], [['S-']]]": Fraction(5, 10) 
    }
}

tensor_c = {
    "profile": [[['O+', 'O-']], [['C+', 'C-']]], 
    "strands": {
        "[[['O+']], [['C+']]]": Fraction(2, 10),
        "[[['O+']], [['C-']]]": Fraction(8, 10),
        "[[['O-']], [['C+']]]": 0, 
        "[[['O-']], [['C-']]]": 1
    }
}

tensor_p = {
    "profile": [[], [['M', 'W'], ['O+', 'O-']]], 
    "strands": {
        "[[], [['M'], ['O+']]]": Fraction(1, 10),
        "[[], [['M'], ['O-']]]": Fraction(4, 10),
        "[[], [['W'], ['O+']]]": Fraction(15, 100),
        "[[], [['W'], ['O-']]]": Fraction(35, 100)
    }
}

tensor_n = {
    "profile": [[['M', 'W'], ['O+', 'O-']], [['MO+', 'MO-', 'WO+', 'WO-']]], 
    "strands": {
        "[[['M'], ['O+']], [['MO+']]]": 1,
        "[[['M'], ['O+']], [['MO-']]]": 0,
        "[[['M'], ['O+']], [['WO+']]]": 0,
        "[[['M'], ['O+']], [['WO-']]]": 0,
        "[[['M'], ['O-']], [['MO+']]]": 0,
        "[[['M'], ['O-']], [['MO-']]]": 1,
        "[[['M'], ['O-']], [['WO+']]]": 0,
        "[[['M'], ['O-']], [['WO-']]]": 0,
        "[[['W'], ['O+']], [['MO+']]]": 0,
        "[[['W'], ['O+']], [['MO-']]]": 0,
        "[[['W'], ['O+']], [['WO+']]]": 1,
        "[[['W'], ['O+']], [['WO-']]]": 0,
        "[[['W'], ['O-']], [['MO+']]]": 0,
        "[[['W'], ['O-']], [['MO-']]]": 0,
        "[[['W'], ['O-']], [['WO+']]]": 0,
        "[[['W'], ['O-']], [['WO-']]]": 1 
    }
}


def main():
    # Problem 1.
    markov_tensor.print_tensor(markov_tensor.composition(tensor_p, tensor_n))
    # profile:  [[], [['MO+', 'MO-', 'WO+', 'WO-']]]
    # [[], [['MO+']]] 1/10
    # [[], [['MO-']]] 2/5
    # [[], [['WO+']]] 3/20
    # [[], [['WO-']]] 7/20

    # Problem 2.
    tensor_empty_mw = markov_tensor.first_marginalization(tensor_p, 2)
    markov_tensor.print_tensor(tensor_empty_mw)
    # profile:  [[], [['M', 'W']]]
    # [[], [['M']]] 1/2
    # [[], [['W']]] 1/2

    # Problem 3.
    tensor_empty_o = markov_tensor.second_marginalization(tensor_p, 2)
    markov_tensor.print_tensor(tensor_empty_o)
    # profile:  [[], [['O+', 'O-']]]
    # [[], [['O+']]] 1/4
    # [[], [['O-']]] 3/4

    # Problem 4.
    markov_tensor.print_tensor(markov_tensor.conversion(tensor_empty_mw, tensor_h))
    # profile:  [[['H', 'M', 'L']], [['M', 'W']]]
    # [[['H']], [['M']]] 2/3
    # [[['M']], [['M']]] 6/11
    # [[['L']], [['M']]] 1/3
    # [[['H']], [['W']]] 1/3
    # [[['M']], [['W']]] 5/11
    # [[['L']], [['W']]] 2/3

    markov_tensor.print_tensor(markov_tensor.conversion(tensor_empty_mw, tensor_s))
    # profile:  [[['S+', 'S-']], [['M', 'W']]]
    # [[['S+']], [['M']]] 0
    # [[['S-']], [['M']]] 2/3
    # [[['S+']], [['W']]] 1
    # [[['S-']], [['W']]] 1/3

    markov_tensor.print_tensor(markov_tensor.conversion(tensor_empty_o, tensor_c))
    # profile:  [[['C+', 'C-']], [['O+', 'O-']]]
    # [[['C+']], [['O+']]] 1
    # [[['C-']], [['O+']]] 4/19
    # [[['C+']], [['O-']]] 0
    # [[['C-']], [['O-']]] 15/19

    # Problem 5.
    markov_tensor.print_tensor(markov_tensor.conversion(tensor_p, tensor_n))
    # profile:  [[['MO+', 'MO-', 'WO+', 'WO-']], [['M', 'W'], ['O+', 'O-']]]
    # [[['MO+']], [['M'], ['O+']]] 1
    # [[['MO-']], [['M'], ['O+']]] 0
    # [[['WO+']], [['M'], ['O+']]] 0
    # [[['WO-']], [['M'], ['O+']]] 0
    # [[['MO+']], [['M'], ['O-']]] 0
    # [[['MO-']], [['M'], ['O-']]] 1
    # [[['WO+']], [['M'], ['O-']]] 0
    # [[['WO-']], [['M'], ['O-']]] 0
    # [[['MO+']], [['W'], ['O+']]] 0
    # [[['MO-']], [['W'], ['O+']]] 0
    # [[['WO+']], [['W'], ['O+']]] 1
    # [[['WO-']], [['W'], ['O+']]] 0
    # [[['MO+']], [['W'], ['O-']]] 0
    # [[['MO-']], [['W'], ['O-']]] 0
    # [[['WO+']], [['W'], ['O-']]] 0
    # [[['WO-']], [['W'], ['O-']]] 1

    # Problem 6.
    markov_tensor.print_tensor(markov_tensor.delta([['M'], ['W']]))
    # profile:  [[['M'], ['W']], [['M'], ['W'], ['M'], ['W']]]
    # [[['M'], ['W']], [['M'], ['W'], ['M'], ['W']]] 1

    # Problem 7. 
    markov_tensor.print_tensor(markov_tensor.tensor_product(tensor_h, tensor_s))
    # profile:  [[['M', 'W'], ['M', 'W']], [['H', 'M', 'L'], ['S+', 'S-']]]
    # [[['M'], ['M']], [['H'], ['S+']]] 0
    # [[['M'], ['M']], [['H'], ['S-']]] 1/5
    # [[['M'], ['W']], [['H'], ['S+']]] 1/10
    # [[['M'], ['W']], [['H'], ['S-']]] 1/10
    # [[['M'], ['M']], [['M'], ['S+']]] 0
    # [[['M'], ['M']], [['M'], ['S-']]] 3/5
    # [[['M'], ['W']], [['M'], ['S+']]] 3/10
    # [[['M'], ['W']], [['M'], ['S-']]] 3/10
    # [[['M'], ['M']], [['L'], ['S+']]] 0
    # [[['M'], ['M']], [['L'], ['S-']]] 1/5
    # [[['M'], ['W']], [['L'], ['S+']]] 1/10
    # [[['M'], ['W']], [['L'], ['S-']]] 1/10
    # [[['W'], ['M']], [['H'], ['S+']]] 0
    # [[['W'], ['M']], [['H'], ['S-']]] 1/10
    # [[['W'], ['W']], [['H'], ['S+']]] 1/20
    # [[['W'], ['W']], [['H'], ['S-']]] 1/20
    # [[['W'], ['M']], [['M'], ['S+']]] 0
    # [[['W'], ['M']], [['M'], ['S-']]] 1/2
    # [[['W'], ['W']], [['M'], ['S+']]] 1/4
    # [[['W'], ['W']], [['M'], ['S-']]] 1/4
    # [[['W'], ['M']], [['L'], ['S+']]] 0
    # [[['W'], ['M']], [['L'], ['S-']]] 2/5
    # [[['W'], ['W']], [['L'], ['S+']]] 1/5
    # [[['W'], ['W']], [['L'], ['S-']]] 1/5

    # Problem 8. 
    markov_tensor.print_tensor(
        markov_tensor.composition(
            markov_tensor.delta([['M', 'W']]), 
            markov_tensor.tensor_product(tensor_h, tensor_s)
        )
    )
    # profile:  [[['M', 'W']], [['H', 'M', 'L'], ['S+', 'S-']]]
    # [[['M']], [['H'], ['S+']]] 0
    # [[['M']], [['H'], ['S-']]] 1/5
    # [[['M']], [['M'], ['S+']]] 0
    # [[['M']], [['M'], ['S-']]] 3/5
    # [[['M']], [['L'], ['S+']]] 0
    # [[['M']], [['L'], ['S-']]] 1/5
    # [[['W']], [['H'], ['S+']]] 1/20
    # [[['W']], [['H'], ['S-']]] 1/20
    # [[['W']], [['M'], ['S+']]] 1/4
    # [[['W']], [['M'], ['S-']]] 1/4
    # [[['W']], [['L'], ['S+']]] 1/5
    # [[['W']], [['L'], ['S-']]] 1/5

    # Problem 9. 
    markov_tensor.print_tensor(
        markov_tensor.tensor_product(
            markov_tensor.composition(
                markov_tensor.delta([['M', 'W']]), 
                markov_tensor.tensor_product(tensor_h, tensor_s)
            ), 
            tensor_c
        )
    )
    # profile:  [[['M', 'W'], ['O+', 'O-']], [['H', 'M', 'L'], ['S+', 'S-'], ['C+', 'C-']]]
    # [[['M'], ['O+']], [['H'], ['S+'], ['C+']]] 0
    # [[['M'], ['O+']], [['H'], ['S+'], ['C-']]] 0
    # [[['M'], ['O-']], [['H'], ['S+'], ['C+']]] 0
    # [[['M'], ['O-']], [['H'], ['S+'], ['C-']]] 0
    # [[['M'], ['O+']], [['H'], ['S-'], ['C+']]] 1/25
    # [[['M'], ['O+']], [['H'], ['S-'], ['C-']]] 4/25
    # [[['M'], ['O-']], [['H'], ['S-'], ['C+']]] 0
    # [[['M'], ['O-']], [['H'], ['S-'], ['C-']]] 1/5
    # [[['M'], ['O+']], [['M'], ['S+'], ['C+']]] 0
    # [[['M'], ['O+']], [['M'], ['S+'], ['C-']]] 0
    # [[['M'], ['O-']], [['M'], ['S+'], ['C+']]] 0
    # [[['M'], ['O-']], [['M'], ['S+'], ['C-']]] 0
    # [[['M'], ['O+']], [['M'], ['S-'], ['C+']]] 3/25
    # [[['M'], ['O+']], [['M'], ['S-'], ['C-']]] 12/25
    # [[['M'], ['O-']], [['M'], ['S-'], ['C+']]] 0
    # [[['M'], ['O-']], [['M'], ['S-'], ['C-']]] 3/5
    # [[['M'], ['O+']], [['L'], ['S+'], ['C+']]] 0
    # [[['M'], ['O+']], [['L'], ['S+'], ['C-']]] 0
    # [[['M'], ['O-']], [['L'], ['S+'], ['C+']]] 0
    # [[['M'], ['O-']], [['L'], ['S+'], ['C-']]] 0
    # [[['M'], ['O+']], [['L'], ['S-'], ['C+']]] 1/25
    # [[['M'], ['O+']], [['L'], ['S-'], ['C-']]] 4/25
    # [[['M'], ['O-']], [['L'], ['S-'], ['C+']]] 0
    # [[['M'], ['O-']], [['L'], ['S-'], ['C-']]] 1/5
    # [[['W'], ['O+']], [['H'], ['S+'], ['C+']]] 1/100
    # [[['W'], ['O+']], [['H'], ['S+'], ['C-']]] 1/25
    # [[['W'], ['O-']], [['H'], ['S+'], ['C+']]] 0
    # [[['W'], ['O-']], [['H'], ['S+'], ['C-']]] 1/20
    # [[['W'], ['O+']], [['H'], ['S-'], ['C+']]] 1/100
    # [[['W'], ['O+']], [['H'], ['S-'], ['C-']]] 1/25
    # [[['W'], ['O-']], [['H'], ['S-'], ['C+']]] 0
    # [[['W'], ['O-']], [['H'], ['S-'], ['C-']]] 1/20
    # [[['W'], ['O+']], [['M'], ['S+'], ['C+']]] 1/20
    # [[['W'], ['O+']], [['M'], ['S+'], ['C-']]] 1/5
    # [[['W'], ['O-']], [['M'], ['S+'], ['C+']]] 0
    # [[['W'], ['O-']], [['M'], ['S+'], ['C-']]] 1/4
    # [[['W'], ['O+']], [['M'], ['S-'], ['C+']]] 1/20
    # [[['W'], ['O+']], [['M'], ['S-'], ['C-']]] 1/5
    # [[['W'], ['O-']], [['M'], ['S-'], ['C+']]] 0
    # [[['W'], ['O-']], [['M'], ['S-'], ['C-']]] 1/4
    # [[['W'], ['O+']], [['L'], ['S+'], ['C+']]] 1/25
    # [[['W'], ['O+']], [['L'], ['S+'], ['C-']]] 4/25
    # [[['W'], ['O-']], [['L'], ['S+'], ['C+']]] 0
    # [[['W'], ['O-']], [['L'], ['S+'], ['C-']]] 1/5
    # [[['W'], ['O+']], [['L'], ['S-'], ['C+']]] 1/25
    # [[['W'], ['O+']], [['L'], ['S-'], ['C-']]] 4/25
    # [[['W'], ['O-']], [['L'], ['S-'], ['C+']]] 0
    # [[['W'], ['O-']], [['L'], ['S-'], ['C-']]] 1/5

    # Problem 10. 
    markov_tensor.print_tensor(
        markov_tensor.conversion(
            tensor_p, 
            markov_tensor.tensor_product(
                markov_tensor.composition(
                    markov_tensor.delta([['M', 'W']]), 
                    markov_tensor.tensor_product(tensor_h, tensor_s)
                ), 
                tensor_c
            )
        )
    )
    # profile:  [[['H', 'M', 'L'], ['S+', 'S-'], ['C+', 'C-']], [['M', 'W'], ['O+', 'O-']]]
    # {[[['H'], ['S+'], ['C+']], [['M'], ['O+']]] 0
    # [[['H'], ['S+'], ['C-']], [['M'], ['O+']]] 0
    # [[['H'], ['S-'], ['C+']], [['M'], ['O+']]] 8/11
    # [[['H'], ['S-'], ['C-']], [['M'], ['O+']]] 32/239
    # [[['M'], ['S+'], ['C+']], [['M'], ['O+']]] 0
    # [[['M'], ['S+'], ['C-']], [['M'], ['O+']]] 0
    # [[['M'], ['S-'], ['C+']], [['M'], ['O+']]] 8/13
    # [[['M'], ['S-'], ['C-']], [['M'], ['O+']]] 96/811
    # [[['L'], ['S+'], ['C+']], [['M'], ['O+']]] 0
    # [[['L'], ['S+'], ['C-']], [['M'], ['O+']]] 0
    # [[['L'], ['S-'], ['C+']], [['M'], ['O+']]] 2/5
    # [[['L'], ['S-'], ['C-']], [['M'], ['O+']]] 8/95
    # [[['H'], ['S+'], ['C+']], [['M'], ['O-']]] 0
    # [[['H'], ['S+'], ['C-']], [['M'], ['O-']]] 0
    # [[['H'], ['S-'], ['C+']], [['M'], ['O-']]] 0
    # [[['H'], ['S-'], ['C-']], [['M'], ['O-']]] 160/239
    # [[['M'], ['S+'], ['C+']], [['M'], ['O-']]] 0
    # [[['M'], ['S+'], ['C-']], [['M'], ['O-']]] 0
    # [[['M'], ['S-'], ['C+']], [['M'], ['O-']]] 0
    # [[['M'], ['S-'], ['C-']], [['M'], ['O-']]] 480/811
    # [[['L'], ['S+'], ['C+']], [['M'], ['O-']]] 0
    # [[['L'], ['S+'], ['C-']], [['M'], ['O-']]] 0
    # [[['L'], ['S-'], ['C+']], [['M'], ['O-']]] 0
    # [[['L'], ['S-'], ['C-']], [['M'], ['O-']]] 8/19
    # [[['H'], ['S+'], ['C+']], [['W'], ['O+']]] 1
    # [[['H'], ['S+'], ['C-']], [['W'], ['O+']]] 12/47
    # [[['H'], ['S-'], ['C+']], [['W'], ['O+']]] 3/11
    # [[['H'], ['S-'], ['C-']], [['W'], ['O+']]] 12/239
    # [[['M'], ['S+'], ['C+']], [['W'], ['O+']]] 1
    # [[['M'], ['S+'], ['C-']], [['W'], ['O+']]] 12/47
    # [[['M'], ['S-'], ['C+']], [['W'], ['O+']]] 5/13
    # [[['M'], ['S-'], ['C-']], [['W'], ['O+']]] 60/811
    # [[['L'], ['S+'], ['C+']], [['W'], ['O+']]] 1
    # [[['L'], ['S+'], ['C-']], [['W'], ['O+']]] 12/47
    # [[['L'], ['S-'], ['C+']], [['W'], ['O+']]] 3/5
    # [[['L'], ['S-'], ['C-']], [['W'], ['O+']]] 12/95
    # [[['H'], ['S+'], ['C+']], [['W'], ['O-']]] 0
    # [[['H'], ['S+'], ['C-']], [['W'], ['O-']]] 35/47
    # [[['H'], ['S-'], ['C+']], [['W'], ['O-']]] 0
    # [[['H'], ['S-'], ['C-']], [['W'], ['O-']]] 35/239
    # [[['M'], ['S+'], ['C+']], [['W'], ['O-']]] 0
    # [[['M'], ['S+'], ['C-']], [['W'], ['O-']]] 35/47
    # [[['M'], ['S-'], ['C+']], [['W'], ['O-']]] 0
    # [[['M'], ['S-'], ['C-']], [['W'], ['O-']]] 175/811
    # [[['L'], ['S+'], ['C+']], [['W'], ['O-']]] 0
    # [[['L'], ['S+'], ['C-']], [['W'], ['O-']]] 35/47
    # [[['L'], ['S-'], ['C+']], [['W'], ['O-']]] 0
    # [[['L'], ['S-'], ['C-']], [['W'], ['O-']]] 7/19

    # Problem 11. 
    markov_tensor.print_tensor(
        markov_tensor.composition(
            markov_tensor.conversion(
                tensor_p, 
                markov_tensor.tensor_product(
                    markov_tensor.composition(
                        markov_tensor.delta([['M', 'W']]), 
                        markov_tensor.tensor_product(tensor_h, tensor_s)
                    ), 
                    tensor_c
                )
            ), 
            tensor_n
        )
    )
    # profile:  [[['H', 'M', 'L'], ['S+', 'S-'], ['C+', 'C-']], [['MO+', 'MO-', 'WO+', 'WO-']]]
    # [[['H'], ['S+'], ['C+']], [['MO+']]] 0
    # [[['H'], ['S+'], ['C+']], [['MO-']]] 0
    # [[['H'], ['S+'], ['C+']], [['WO+']]] 1
    # [[['H'], ['S+'], ['C+']], [['WO-']]] 0
    # [[['H'], ['S+'], ['C-']], [['MO+']]] 0
    # [[['H'], ['S+'], ['C-']], [['MO-']]] 0
    # [[['H'], ['S+'], ['C-']], [['WO+']]] 12/47
    # [[['H'], ['S+'], ['C-']], [['WO-']]] 35/47
    # [[['H'], ['S-'], ['C+']], [['MO+']]] 8/11
    # [[['H'], ['S-'], ['C+']], [['MO-']]] 0
    # [[['H'], ['S-'], ['C+']], [['WO+']]] 3/11
    # [[['H'], ['S-'], ['C+']], [['WO-']]] 0
    # [[['H'], ['S-'], ['C-']], [['MO+']]] 32/239
    # [[['H'], ['S-'], ['C-']], [['MO-']]] 160/239
    # [[['H'], ['S-'], ['C-']], [['WO+']]] 12/239
    # [[['H'], ['S-'], ['C-']], [['WO-']]] 35/239
    # [[['M'], ['S+'], ['C+']], [['MO+']]] 0
    # [[['M'], ['S+'], ['C+']], [['MO-']]] 0
    # [[['M'], ['S+'], ['C+']], [['WO+']]] 1
    # [[['M'], ['S+'], ['C+']], [['WO-']]] 0
    # [[['M'], ['S+'], ['C-']], [['MO+']]] 0
    # [[['M'], ['S+'], ['C-']], [['MO-']]] 0
    # [[['M'], ['S+'], ['C-']], [['WO+']]] 12/47
    # [[['M'], ['S+'], ['C-']], [['WO-']]] 35/47
    # [[['M'], ['S-'], ['C+']], [['MO+']]] 8/13
    # [[['M'], ['S-'], ['C+']], [['MO-']]] 0
    # [[['M'], ['S-'], ['C+']], [['WO+']]] 5/13
    # [[['M'], ['S-'], ['C+']], [['WO-']]] 0
    # [[['M'], ['S-'], ['C-']], [['MO+']]] 96/811
    # [[['M'], ['S-'], ['C-']], [['MO-']]] 480/811
    # [[['M'], ['S-'], ['C-']], [['WO+']]] 60/811
    # [[['M'], ['S-'], ['C-']], [['WO-']]] 175/811
    # [[['L'], ['S+'], ['C+']], [['MO+']]] 0
    # [[['L'], ['S+'], ['C+']], [['MO-']]] 0
    # [[['L'], ['S+'], ['C+']], [['WO+']]] 1
    # [[['L'], ['S+'], ['C+']], [['WO-']]] 0
    # [[['L'], ['S+'], ['C-']], [['MO+']]] 0
    # [[['L'], ['S+'], ['C-']], [['MO-']]] 0
    # [[['L'], ['S+'], ['C-']], [['WO+']]] 12/47
    # [[['L'], ['S+'], ['C-']], [['WO-']]] 35/47
    # [[['L'], ['S-'], ['C+']], [['MO+']]] 2/5
    # [[['L'], ['S-'], ['C+']], [['MO-']]] 0
    # [[['L'], ['S-'], ['C+']], [['WO+']]] 3/5
    # [[['L'], ['S-'], ['C+']], [['WO-']]] 0
    # [[['L'], ['S-'], ['C-']], [['MO+']]] 8/95
    # [[['L'], ['S-'], ['C-']], [['MO-']]] 8/19
    # [[['L'], ['S-'], ['C-']], [['WO+']]] 12/95
    # [[['L'], ['S-'], ['C-']], [['WO-']]] 7/19

    # Problem 12. 


if __name__ == "__main__":
    main()
